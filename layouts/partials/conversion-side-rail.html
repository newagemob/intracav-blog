{{- /* Conversion Side-Rail - Subtle Team Pathway */ -}}
{{- /* Only show on policy pages, after user scrolls 50% */ -}}
{{- if and .IsPage (eq .Params.content_type "policies") (not .Params.emergency) -}}
<aside class="conversion-side-rail" id="conversion-side-rail" aria-label="For teams">
  <button class="conversion-side-rail-dismiss" aria-label="Dismiss" onclick="this.parentElement.style.display='none'">Ã—</button>
  <div class="conversion-side-rail-header">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.6;">
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
      <circle cx="9" cy="7" r="4"></circle>
      <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
      <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
    </svg>
    <h3 class="conversion-side-rail-title">For Teams</h3>
  </div>
  <div class="conversion-side-rail-content">
    <p>Standardize this policy across your team with version control and compliance tracking.</p>
  </div>
  <a href="https://qpolicy.ai" class="conversion-side-rail-link" target="_blank" rel="noopener noreferrer">
    Learn about qpolicy.ai
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; margin-left: 4px;">
      <line x1="5" y1="12" x2="19" y2="12"></line>
      <polyline points="12 5 19 12 12 19"></polyline>
    </svg>
  </a>
</aside>

<script>
  // Show side-rail after user scrolls 50% of content
  (function() {
    const sideRail = document.getElementById('conversion-side-rail');
    if (!sideRail) return;

    let hasShown = false;
    const threshold = 0.5; // 50% scroll

    function checkScroll() {
      if (hasShown) return;

      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const scrollPercent = scrollTop / (documentHeight - windowHeight);

      if (scrollPercent >= threshold) {
        sideRail.style.display = 'block';
        hasShown = true;
      }
    }

    window.addEventListener('scroll', checkScroll, { passive: true });
    checkScroll(); // Check on load
  })();
</script>
{{- end -}}
